-- ROBLOX CHAT SPY (JULY 2025 WORKING VERSION)
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- Force enable legacy chat events
ReplicatedStorage:WaitForChild("DefaultChatSystemChatEvents")

-- Configuration
local Config = {
    enabled = true,
    spyOnMyself = true,
    public = true,
    publicItalics = true
}

-- 1. CHAT CHANNEL INTERCEPTOR
for _, channelName in ipairs({"RBXWhisper", "RBXTeam"}) do
    local channel = TextChatService.TextChannels:WaitForChild(channelName)
    
    -- 2. DIRECT FUNCTION HOOKING
    local originalEvent = channel.OnMessageReceived
    channel.OnMessageReceived = function(message)
        if Config.enabled then
            local textSource = message.TextSource
            if textSource and (Config.spyOnMyself or textSource.UserId ~= player.UserId) then
                -- 3. EXTRACT RAW MESSAGE CONTENT
                local msgContent = message.Text
                local senderName = textSource.Name
                
                -- 4. REBROADCAST TO PUBLIC CHAT
                local formatted = Config.publicItalics and "/me " or ""
                formatted = formatted .. "{SPY} [".. senderName .."]: ".. msgContent
                
                task.spawn(function()
                    ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(
                        formatted, 
                        "All"
                    )
                end)
            end
        end
        return originalEvent(message)
    end
end

-- 5. COMMAND HANDLER (AGGRESSIVE VERSION)
player.Chatted:Connect(function(message)
    if string.lower(message) == "/spy" then
        Config.enabled = not Config.enabled
        ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(
            "{SPY} "..(Config.enabled and "ENABLED" or "DISABLED"), 
            "All"
        )
    end
end)

-- 6. INITIALIZATION
ReplicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer("{SPY} ACTIVE", "All")
warn("CHAT SPY SUCCESSFULLY INJECTED")
