-- ROBLOX CHAT SPY (2025 COMPLIANT)
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local player = Players.LocalPlayer

-- Configuration
local Config = {
    enabled = true,
    spyOnMyself = true,
    public = false
}

-- Track active instance
local instance = (_G.chatSpyInstance or 0) + 1
_G.chatSpyInstance = instance

-- 2025 Status Message System
local function displayStatus()
    local status = Config.enabled and "ENABLED" or "DISABLED"
    TextChatService:DisplaySystemMessage(`<font color="#00FFFF">[SPY {status}]</font>`)
end

-- 2025 Command Handler
player.Chatted:Connect(function(message)
    if string.lower(message) == "/spy" then
        Config.enabled = not Config.enabled
        displayStatus()
    end
end)

-- 2025 Message Handling
TextChatService.MessageReceived:Connect(function(message)
    if not Config.enabled or _G.chatSpyInstance ~= instance then return end
    
    local textSource = message.TextSource
    if not textSource then return end
    
    -- 2025 Channel Detection
    local channel = message.TextChannel
    if not channel then return end
    
    -- 2025 Private Message Detection
    local isPrivate = (channel.Name == "RBXWhisper" or channel.Name == "RBXTeam")
    local isLocalPlayer = textSource.UserId == player.UserId
    
    if isPrivate and (Config.spyOnMyself or not isLocalPlayer) then
        local msgContent = message.Text or ""
        local senderName = textSource.DisplayName or textSource.Name or "Unknown"
        
        -- 2025 Output Formatting
        local spyMessage = `<font color="#00FFFF">[SPY] [{senderName}]: {msgContent}</font>`
        
        if Config.public then
            -- 2025 Public Broadcast
            TextChatService:PostAsync(spyMessage, "RBXGeneral")
        else
            -- 2025 Private System Message
            TextChatService:DisplaySystemMessage(spyMessage)
        end
    end
end)

-- Initialization
task.defer(function()
    displayStatus()
    print("Chat Spy Active - Type /spy to toggle")
end)
