local player = game:GetService("Players").LocalPlayer
local runService = game:GetService("RunService")

local armorStandName = "BattleArmorStand"
local healPadName = "HealPad"
local cooldown = 0.5 -- Adjust for performance balance
local lastHealth = 0

local function fireTouch(target)
    if not target or not player.Character then return end
    local root = player.Character:FindFirstChild("HumanoidRootPart")
    if not root then return end
    
    firetouchinterest(root, target, 0)
    firetouchinterest(root, target, 1)
end

local function checkHealPad(healPad)
    local padPart = healPad:FindFirstChild("Pad")
    if padPart and padPart:IsA("BasePart") then
        local currentColor = padPart.Color
        local inactiveColor = Color3.new(196/255, 40/255, 28/255)
        
        if currentColor == inactiveColor then
            return true
        end
    end
    return false
end

local function healPadLoop()
    while true do
        task.wait(cooldown)
        for _, healPad in ipairs(workspace:GetChildren()) do
            if healPad.Name == healPadName then
                if checkHealPad(healPad) then
                    fireTouch(healPad.Pad)
                end
            end
        end
    end
end

local function armorStandLoop()
    while true do
        task.wait(cooldown)
        for _, stand in ipairs(workspace:GetChildren()) do
            if stand.Name == armorStandName and stand:FindFirstChild("TouchInterest") then
                fireTouch(stand)
            end
        end
    end
end

local function healthMonitor()
    while true do
        if player.Character then
            local humanoid = player.Character:FindFirstChild("Humanoid")
            if humanoid then
                if humanoid.Health < lastHealth then
                    coroutine.wrap(healPadLoop)()
                end
                lastHealth = humanoid.Health
            end
        end
        task.wait(0.1)
    end
end

-- Initialize character monitoring
player.CharacterAdded:Connect(function(character)
    character:WaitForChild("Humanoid")
    lastHealth = character.Humanoid.Health
    
    -- Start armor collection immediately
    coroutine.wrap(armorStandLoop)()
    
    -- Start secondary heal check after armor acquisition
    coroutine.wrap(healPadLoop)()
end)

-- Start health monitoring
coroutine.wrap(healthMonitor)()

-- Initial check if already in game
if player.Character then
    coroutine.wrap(armorStandLoop)()
    coroutine.wrap(healPadLoop)()
end

-- Performance optimization
runService.Heartbeat:Wait()
