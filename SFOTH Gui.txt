local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer
local Toggle = true

-- Toggle system with audio feedback
UIS.InputBegan:Connect(function(Input)
    if Input.KeyCode == Enum.KeyCode.H then
        Toggle = not Toggle
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "SYSTEM: "..(Toggle and "ON" or "OFF"),
            Text = Toggle and "Full functionality enabled" or "All features disabled",
            Duration = 2
        })
    end
end)

local function GetAllItems(ModelName)
    local items = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj.Name == ModelName and obj:IsA("Model") then
            local interactPart = obj:FindFirstChild("TouchInterest") and obj:FindFirstChild("TouchInterest").Parent
                            or obj:FindFirstChildWhichIsA("Part")
            if interactPart then
                table.insert(items, interactPart)
            end
        end
    end
    return items
end

local function UseAllPads()
    if not LP.Character then return end
    local humanoid = LP.Character:FindFirstChild("Humanoid")
    if not humanoid or humanoid.Health >= humanoid.MaxHealth then return end

    local healPads = GetAllItems("HealPad")
    for _, padPart in ipairs(healPads) do
        -- Double-tap interaction for reliability
        firetouchinterest(LP.Character.HumanoidRootPart, padPart, 0)
        task.wait(0.15)
        firetouchinterest(LP.Character.HumanoidRootPart, padPart, 1)
        task.wait(0.15)
        firetouchinterest(LP.Character.HumanoidRootPart, padPart, 0)
        task.wait(0.15)
        firetouchinterest(LP.Character.HumanoidRootPart, padPart, 1)
        
        -- Emergency exit if healed during process
        if humanoid.Health == humanoid.MaxHealth then break end
    end
end

local function CollectArmor()
    local armorStands = GetAllItems("BattleArmorStand")
    for _, armorPart in ipairs(armorStands) do
        firetouchinterest(LP.Character.HumanoidRootPart, armorPart, 0)
        task.wait(0.1)
        firetouchinterest(LP.Character.HumanoidRootPart, armorPart, 1)
        if LP.Character:FindFirstChild("BattleArmor") then break end
    end
end

-- Main system loop
task.spawn(function()
    while task.wait(0.5) do
        if Toggle and LP.Character then
            -- Automatic armor maintenance
            if not LP.Character:FindFirstChild("BattleArmor") then
                CollectArmor()
            end
            
            -- Aggressive healing system
            if LP.Character:FindFirstChild("Humanoid") then
                if LP.Character.Humanoid.Health < LP.Character.Humanoid.MaxHealth then
                    UseAllPads()
                end
            end
        end
    end
end)

-- Initial notification
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "SFOTH ULTIMATE SCRIPT",
    Text = "Guaranteed armor/heal\nUsing all available pads",
    Duration = 5
})
