local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer
local Toggle = true
local Cooldown = false

-- Toggle with H key
UIS.InputBegan:Connect(function(Input)
    if Input.KeyCode == Enum.KeyCode.H then
        Toggle = not Toggle
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "SYSTEM: "..(Toggle and "ON" or "OFF"),
            Text = "Auto Armor/Heal "..(Toggle and "Enabled" or "Disabled"),
            Duration = 2
        })
    end
end)

local function GetItem(ModelName)
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj.Name == ModelName and obj:IsA("Model") then
            local touchPart = obj:FindFirstChildWhichIsA("Part")
print("Found interactable part for", ModelName, ":", armorPart and armorPart:GetFullName() or "NOT FOUND")
            if touchPart then
                return touchPart
            end
        end
    end
    return nil
end

local function CollectArmor()
    if not Toggle or Cooldown then return end
    Cooldown = true
    
    local armorPart = GetItem("BattleArmorStand")
    if armorPart and LP.Character then
        local humanoid = LP.Character:FindFirstChild("Humanoid")
        local root = LP.Character:FindFirstChild("HumanoidRootPart")
        
        if humanoid and root then
            -- Simulate direct interaction
            firetouchinterest(root, armorPart, 0) -- Begin touch
            firetouchinterest(root, armorPart, 1) -- End touch
            
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "Armor Collected",
                Text = "Equipped Battle Armor",
                Duration = 2
            })
        end
    end
    Cooldown = false
end

local function AutoHeal()
    if not Toggle or Cooldown then return end
    Cooldown = true
    
    local healPart = GetItem("HealPad")
    if healPart and LP.Character then
        local humanoid = LP.Character:FindFirstChild("Humanoid")
        local root = LP.Character:FindFirstChild("HumanoidRootPart")
        
        if humanoid and humanoid.Health < humanoid.MaxHealth and root then
            -- Direct interaction with heal pad
            firetouchinterest(root, healPart, 0)
            firetouchinterest(root, healPart, 1)
            
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "Healing Activated",
                Text = "Using Regeneration Pad",
                Duration = 2
            })
        end
    end
    Cooldown = false
end

-- Main system
LP.CharacterAdded:Connect(function(char)
    task.wait(1)
    CollectArmor()
    
    char:WaitForChild("Humanoid").HealthChanged:Connect(function()
        if Toggle then
            AutoHeal()
        end
    end)
end)

-- Automatic armor re-acquisition
while true do
    if Toggle and LP.Character and not LP.Character:FindFirstChild("BattleArmor") then
        CollectArmor()
    end
    task.wait(5)
end
