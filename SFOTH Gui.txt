local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local LP = Players.LocalPlayer
local Toggle = false
local Debounce = false

-- Toggle with H key
UIS.InputBegan:Connect(function(Input)
    if Input.KeyCode == Enum.KeyCode.H then
        Toggle = not Toggle
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Auto Armor/Heal",
            Text = Toggle and "ACTIVATED" or "DEACTIVATED",
            Duration = 1
        })
    end
end)

local function FindModel(Name)
    return workspace:FindFirstChild(Name, true)
end

local function CollectItem(ModelName, IsArmor)
    if Debounce or not Toggle then return end
    Debounce = true
    
    local Model = FindModel(ModelName)
    if Model and LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
        local ItemPart = Model:FindFirstChild("Main") or Model:FindFirstChildOfClass("Part")
        local OriginalCF = LP.Character.HumanoidRootPart.CFrame
        
        if ItemPart then
            -- Store original transparency
            local originalTransparency = ItemPart.Transparency
            ItemPart.Transparency = 1
            
            -- Teleport to item
            LP.Character.HumanoidRootPart.CFrame = ItemPart.CFrame + Vector3.new(0, 3, 0)
            
            -- Simulate collection without destroying
            RunService.Heartbeat:Wait()
            task.wait(0.15)
            
            -- Return to original position
            LP.Character.HumanoidRootPart.CFrame = OriginalCF
            
            -- Only destroy armor, restore heal pad visibility
            if IsArmor then
                Model:Destroy()
            else
                ItemPart.Transparency = originalTransparency
            end
        end
    end
    Debounce = false
end

-- Auto armor on spawn/respawn
LP.CharacterAdded:Connect(function(Char)
    if Toggle then
        repeat task.wait() until Char:FindFirstChild("HumanoidRootPart")
        CollectItem("BattleArmorStand", true)
    end
end)

-- Auto heal when damaged
LP.CharacterAdded:Connect(function(Char)
    local Hum = Char:WaitForChild("Humanoid")
    Hum.HealthChanged:Connect(function()
        if Toggle and Hum.Health < Hum.MaxHealth then
            CollectItem("HealPad", false)
        end
    end)
end)

-- Initial notification
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "SFOTH Script Active",
    Text = "HealPads remain visible\nArmor auto-collects on respawn\nPress H to toggle",
    Duration = 5
})
