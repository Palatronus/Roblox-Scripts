-- Universal Chat Spy Script for Roblox
-- Safe, reliable approach without GUI conflicts

if not game:IsLoaded() then
    game.Loaded:Wait()
end

-- Get necessary services
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local LocalPlayer = Players.LocalPlayer

-- Safe message display function
local function displaySpyMessage(playerName, message)
    -- Use Roblox's built-in system message display
    if TextChatService.DisplaySystemMessage then
        local formatted = string.format(
            '<font color="rgb(255,85,85)">[SPY] %s:</font> %s',
            playerName,
            message
        )
        TextChatService:DisplaySystemMessage(formatted)
    end
    
    -- Alternative: Print to console
    print(string.format("[SPY] %s: %s", playerName, message))
end

-- Function to capture chat messages
local function captureChatMessages()
    -- Listen to player chat events
    local function onPlayerChatted(player, message)
        if player ~= LocalPlayer then
            displaySpyMessage(player.Name, message)
        end
    end
    
    -- Capture existing players
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            player.Chatted:Connect(function(message)
                onPlayerChatted(player, message)
            end)
        end
    end
    
    -- Capture new players
    Players.PlayerAdded:Connect(function(player)
        player.Chatted:Connect(function(message)
            onPlayerChatted(player, message)
        end)
    end)
    
    -- Initial message
    displaySpyMessage("System", "Chat spy activated")
end

-- Initialize with error handling
local success, err = pcall(captureChatMessages)
if success then
    print("Chat Spy Activated - Messages will appear with [SPY] tag")
else
    warn("Chat Spy Error: "..tostring(err))
end
