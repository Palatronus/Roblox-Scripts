local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local Player = Players.LocalPlayer

-- GUI Setup
local ToggleButton = Instance.new("ImageButton")
ToggleButton.Image = "rbxasset://textures/ui/mouseLock_off@2x.png"
ToggleButton.Position = UDim2.new(1, -50, 0.5, -20)
ToggleButton.Parent = Player.PlayerGui:WaitForChild("ShiftLockUI")

-- Core Logic
local isActive = false
local yaw = 0

UserInputService.InputChanged:Connect(function(input)
    if isActive and input.UserInputType == Enum.UserInputType.MouseMovement then
        local rootPart = Player.Character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            yaw -= input.Delta.X * 0.5 -- Rotation speed
            rootPart.CFrame = CFrame.new(rootPart.Position) * CFrame.Angles(0, math.rad(yaw), 0)
        end
    end
end)

ToggleButton.MouseButton1Click:Connect(function()
    isActive = not isActive
    ToggleButton.Image = isActive 
        and "rbxasset://textures/ui/mouseLock_on@2x.png" 
        or "rbxasset://textures/ui/mouseLock_off@2x.png"
    
    Player.Character.Humanoid.AutoRotate = not isActive
    if isActive then
        yaw = Player.Character.HumanoidRootPart.Orientation.Y
    end
end)
