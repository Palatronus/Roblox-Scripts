local uis = game:GetService("UserInputService")
local plrs = game:GetService("Players")
local rus = game:GetService("RunService")
local lp = plrs.LocalPlayer
local mouse = lp:GetMouse()
local e = Enum

-- Original code constants
local enumMLCP = e.MouseBehavior.LockCurrentPosition
local enumMLC = (uis.TouchEnabled and enumMLCP) or e.MouseBehavior.LockCenter
local enumMD = e.MouseBehavior.Default

-- Create required UI elements FIRST
local i10 = Instance.new("ScreenGui")
i10.Name = "ShiftLockGUI"
i10.ZIndexBehavior = e.ZIndexBehavior.Sibling
i10.ResetOnSpawn = false
i10.Parent = lp:WaitForChild("PlayerGui")

local i1 = Instance.new("Frame")
i1.Name = "MainFrame"
i1.AnchorPoint = Vector2.new(0.5, 0.5)
i1.Position = UDim2.new(0.5, 0, 0.5, 0)
i1.Size = UDim2.new(0, 0, 0, 0)
i1.Visible = false
i1.Parent = i10

-- ShiftLock state management
local shiftlock = false
local mouseBehavior = enumMD
local lastMouseBehavior = uis.MouseBehavior

-- Original mouse behavior enforcement
uis:GetPropertyChangedSignal("MouseBehavior"):Connect(function()
    if shiftlock and uis.MouseBehavior ~= mouseBehavior then
        uis.MouseBehavior = mouseBehavior
    end
end)

-- Your original toggle logic with instant response
uis.InputBegan:Connect(function(input)
    if input.KeyCode == e.KeyCode.LeftShift then
        shiftlock = not shiftlock
        mouseBehavior = shiftlock and enumMLC or enumMD
        i1.Visible = shiftlock
        uis.MouseBehavior = mouseBehavior
        
        -- Proper camera control from original script
        if shiftlock then
            mouse.TargetFilter = i1
            workspace.CurrentCamera.CameraType = e.CameraType.Scriptable
        else
            mouse.TargetFilter = nil
            workspace.CurrentCamera.CameraType = e.CameraType.Custom
        end
    end
end)

-- Your original draggable implementation
local function Draggable(window)
    local MB1 = e.UserInputType.MouseButton1
    local dragStartPos, mouseStartPos
    
    window.InputBegan:Connect(function(input)
        if input.UserInputType == MB1 then
            dragStartPos = window.Position
            mouseStartPos = uis:GetMouseLocation()
        end
    end)
    
    uis.InputChanged:Connect(function(input)
        if input.UserInputType == MB1 and dragStartPos then
            local delta = uis:GetMouseLocation() - mouseStartPos
            window.Position = UDim2.new(
                dragStartPos.X.Scale, 
                dragStartPos.X.Offset + delta.X,
                dragStartPos.Y.Scale, 
                dragStartPos.Y.Offset + delta.Y
            )
        end
    end)
    
    uis.InputEnded:Connect(function(input)
        if input.UserInputType == MB1 then
            dragStartPos = nil
        end
    end)
end

-- Initialize draggable frame as per original code
Draggable(i1)

print("ShiftLock Initialized - Press LeftShift to toggle")
warn("Camera will now follow standard Roblox shiftlock behavior")
