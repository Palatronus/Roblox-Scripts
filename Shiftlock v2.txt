--[[
    WARNING: Heads up! This script has not been verified by ScriptBlox. Use at your own risk!
]]
local ShiftLockScreenGui = Instance.new("ScreenGui")
local ShiftLockButton = Instance.new("ImageButton")
local ShiftlockCursor = Instance.new("ImageLabel")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer

-- Configuration
local CAMERA_OFFSET = CFrame.new(0, 2, 10) -- Adjust these values to your preference
local SENSITIVITY = 0.3
local MAX_PITCH = 70
local MIN_PITCH = -70

-- States and References
local States = {
    Off = "rbxasset://textures/ui/mouseLock_off@2x.png",
    On = "rbxasset://textures/ui/mouseLock_on@2x.png",
    Lock = "rbxasset://textures/MouseLockedCursor.png"
}
local ActiveConnection
local CurrentPitch = 0
local CurrentYaw = 0

-- GUI Setup
ShiftLockScreenGui.Name = "Shiftlock"
ShiftLockScreenGui.Parent = CoreGui
ShiftLockScreenGui.ResetOnSpawn = false

ShiftLockButton.Name = "ShiftLockButton"
ShiftLockButton.Parent = ShiftLockScreenGui
ShiftLockButton.BackgroundTransparency = 1
ShiftLockButton.Position = UDim2.new(0.9, 0, 0.5, 0)
ShiftLockButton.Size = UDim2.new(0.06, 0, 0.06, 0)
ShiftLockButton.Image = States.Off

ShiftlockCursor.Name = "ShiftlockCursor"
ShiftlockCursor.Parent = ShiftLockScreenGui
ShiftlockCursor.Image = States.Lock
ShiftlockCursor.Size = UDim2.new(0, 32, 0, 32) -- Fixed pixel size
ShiftlockCursor.AnchorPoint = Vector2.new(0.5, 0.5)
ShiftlockCursor.Position = UDim2.new(0.5, 0, 0.5, 0)
ShiftlockCursor.BackgroundTransparency = 1
ShiftlockCursor.Visible = false

-- Core Functionality
local function UpdateCamera()
    local HumanoidRootPart = Player.Character:WaitForChild("HumanoidRootPart")
    local Camera = workspace.CurrentCamera
    
    -- Calculate new CFrame
    local BaseCFrame = CFrame.new(HumanoidRootPart.Position)
    local RotatedCFrame = BaseCFrame * CFrame.Angles(0, math.rad(CurrentYaw), 0)
    local PitchedCFrame = RotatedCFrame * CFrame.Angles(math.rad(-CurrentPitch), 0, 0)
    
    -- Update camera and character
    HumanoidRootPart.CFrame = RotatedCFrame
    Camera.CFrame = PitchedCFrame * CAMERA_OFFSET
end

ShiftLockButton.MouseButton1Click:Connect(function()
    if not ActiveConnection then
        -- Enable Shiftlock
        ShiftLockButton.Image = States.On
        ShiftlockCursor.Visible = true
        Player.Character.Humanoid.AutoRotate = false
        
        -- Store initial rotation
        CurrentYaw = Player.Character.HumanoidRootPart.Orientation.Y
        CurrentPitch = 0
        
        ActiveConnection = RunService.RenderStepped:Connect(function()
            -- Allow RMB override
            if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
                -- Preserve default RMB camera behavior
                workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
                return
            end
            
            -- Process mouse movement
            workspace.CurrentCamera.CameraType = Enum.CameraType.Scriptable
            local MouseDelta = UserInputService:GetMouseDelta()
            
            CurrentYaw = CurrentYaw - (MouseDelta.X * SENSITIVITY)
            CurrentPitch = math.clamp(CurrentPitch + (MouseDelta.Y * SENSITIVITY), MIN_PITCH, MAX_PITCH)
            
            UpdateCamera()
        end)
    else
        -- Disable Shiftlock
        ShiftLockButton.Image = States.Off
        ShiftlockCursor.Visible = false
        Player.Character.Humanoid.AutoRotate = true
        workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
        
        ActiveConnection:Disconnect()
        ActiveConnection = nil
    end
end)
