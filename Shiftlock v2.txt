-- Proper service initialization
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- Core components
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Enum = Enum

-- Mouse behavior enums
local MOUSE_BEHAVIOR = {
    LockCurrentPosition = Enum.MouseBehavior.LockCurrentPosition,
    LockCenter = Enum.MouseBehavior.LockCenter,
    Default = Enum.MouseBehavior.Default
}

-- Configuration
local shiftlockEnabled = false
local currentMouseBehavior = MOUSE_BEHAVIOR.Default
local touchEnabled = UserInputService.TouchEnabled

-- Create necessary UI container
local ShiftlockGUI = Instance.new("ScreenGui")
ShiftlockGUI.Name = "ShiftlockSystem"
ShiftlockGUI.ResetOnSpawn = false
ShiftlockGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ShiftlockGUI.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Mouse target frame
local TargetFrame = Instance.new("Frame")
TargetFrame.Name = "MouseTarget"
TargetFrame.Size = UDim2.new(0, 0, 0, 0)
TargetFrame.Visible = false
TargetFrame.Parent = ShiftlockGUI

-- Mouse behavior management
local function UpdateMouseBehavior()
    UserInputService.MouseBehavior = currentMouseBehavior
    Mouse.TargetFilter = shiftlockEnabled and TargetFrame or nil
end

-- Shift toggle handler
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.LeftShift then
        shiftlockEnabled = not shiftlockEnabled
        currentMouseBehavior = shiftlockEnabled and 
            (touchEnabled and MOUSE_BEHAVIOR.LockCurrentPosition or MOUSE_BEHAVIOR.LockCenter) 
            or MOUSE_BEHAVIOR.Default
        
        UpdateMouseBehavior()
        TargetFrame.Visible = shiftlockEnabled
    end
end)

-- Behavior enforcement
UserInputService:GetPropertyChangedSignal("MouseBehavior"):Connect(function()
    if UserInputService.MouseBehavior ~= currentMouseBehavior then
        UserInputService.MouseBehavior = currentMouseBehavior
    end
end)

-- Touch device support
if touchEnabled then
    UserInputService.TouchTap:Connect(function()
        if shiftlockEnabled then
            currentMouseBehavior = MOUSE_BEHAVIOR.LockCurrentPosition
            UpdateMouseBehavior()
        end
    end)
end

-- Continuous behavior maintenance
RunService.Heartbeat:Connect(UpdateMouseBehavior)

print("Shiftlock system operational. Press Left Shift to toggle lock state")
