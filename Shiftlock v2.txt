local uis = game:GetService("UserInputService")
local plr = game:GetService("Players").LocalPlayer
local mouse = plr:GetMouse()
local e = Enum

-- Mouse behavior enums
local enumMLCP = e.MouseBehavior.LockCurrentPosition
local enumMLC = (uis.TouchEnabled and enumMLCP) or e.MouseBehavior.LockCenter
local enumMD = e.MouseBehavior.Default

-- Ensure GUI elements exist
local gui = Instance.new("ScreenGui")
gui.Name = "ShiftlockGUI"
gui.Parent = plr.PlayerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 0, 0, 0)
frame.Visible = false
frame.Parent = gui

-- Shiftlock state
local shiftlock = false
local lastMouseBehavior = uis.MouseBehavior

-- Proper mouse handler
uis.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.LeftShift then
        shiftlock = not shiftlock
        lastMouseBehavior = shiftlock and enumMLC or enumMD
        uis.MouseBehavior = lastMouseBehavior
        
        -- Proper mouse lock implementation
        if shiftlock then
            mouse.TargetFilter = frame
        else
            mouse.TargetFilter = nil
        end
    end
end)

-- Mouse behavior enforcement
uis:GetPropertyChangedSignal("MouseBehavior"):Connect(function()
    if shiftlock and uis.MouseBehavior ~= lastMouseBehavior then
        uis.MouseBehavior = lastMouseBehavior
    end
end)

print("Shiftlock system initialized - Press Left Shift to toggle")
