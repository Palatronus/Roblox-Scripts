local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Player = Players.LocalPlayer

-- ========== GUI SETUP ==========
local ShiftLockUI = Instance.new("ScreenGui")
ShiftLockUI.Name = "ShiftLockSystem"
ShiftLockUI.ResetOnSpawn = false
ShiftLockUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ShiftLockUI.Parent = game:GetService("CoreGui")

local ToggleButton = Instance.new("ImageButton")
ToggleButton.Name = "ShiftLockToggle"
ToggleButton.Image = "rbxassetid://13270449333" -- Official Roblox icon
ToggleButton.BackgroundTransparency = 1
ToggleButton.Size = UDim2.new(0, 45, 0, 45)
ToggleButton.Position = UDim2.new(1, -60, 0.5, -22.5)
ToggleButton.AnchorPoint = Vector2.new(1, 0.5)
ToggleButton.Visible = true
ToggleButton.Parent = ShiftLockUI

-- ========== CORE FUNCTIONALITY ==========
local isActive = false
local yaw = 0

local function RotateCharacter(deltaX)
    local character = Player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    
    if humanoid and rootPart then
        yaw = yaw - (deltaX * 0.4) -- 0.4 = Rotation speed
        rootPart.CFrame = CFrame.new(rootPart.Position) * CFrame.Angles(0, math.rad(yaw), 0)
    end
end

UserInputService.InputChanged:Connect(function(input)
    if isActive and (input.UserInputType == Enum.UserInputType.MouseMovement 
       or input.UserInputType == Enum.UserInputType.Touch) then
        RotateCharacter(input.Delta.X)
    end
end)

ToggleButton.MouseButton1Click:Connect(function()
    isActive = not isActive
    ToggleButton.Image = isActive and "rbxassetid://13270450007" or "rbxassetid://13270449333"
    
    if Player.Character and Player.Character:FindFirstChild("Humanoid") then
        Player.Character.Humanoid.AutoRotate = not isActive
        if isActive then
            yaw = Player.Character.HumanoidRootPart.Orientation.Y
        end
    end
end)

-- ========== GUARANTEED VISIBILITY ==========
game.Loaded:Wait()
ShiftLockUI.Enabled = true
