-- Server-side (Script)
local Tool = script.Parent
local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local ReanimateEvent = Instance.new("RemoteEvent", RS)
ReanimateEvent.Name = "ReanimateEvent"

local deadPlayers = {}
local FlingForce = 5000 -- Adjust fling power

-- God Mode Setup
local function grantGodMode(player)
    if player.Character then
        local humanoid = player.Character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = 32
            humanoid.JumpPower = 75
            humanoid:SetAttribute("Invincible", true)
            
            -- Noclip Toggle
            local noclip = false
            game:GetService("RunService").Stepped:Connect(function()
                if noclip and player.Character then
                    for _, part in pairs(player.Character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end)
            
            -- Noclip Toggle Keybind (Press G)
            player:GetMouse().KeyDown:Connect(function(key)
                if key:lower() == "g" then
                    noclip = not noclip
                end
            end)
        end
    end
end

-- Handle Death/Reanimation
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(char)
        grantGodMode(player)
        local humanoid = char:WaitForChild("Humanoid")
        
        humanoid.Died:Connect(function()
            local corpse = char:Clone()
            corpse:SetAttribute("IsDead", true)
            corpse:PivotTo(char:GetPivot())
            corpse.Parent = workspace
            deadPlayers[player] = corpse
            char:Destroy()
        end)
    end)
end)

ReanimateEvent.OnServerEvent:Connect(function(plr, target)
    if target:IsA("BasePart") then
        -- Fling Mechanic
        if target.Parent:FindFirstChild("Humanoid") then
            local root = target.Parent:FindFirstChild("HumanoidRootPart")
            if root then
                root.Velocity = Vector3.new(0,FlingForce,0)
                root.RotVelocity = Vector3.new(math.random(-50,50),math.random(-50,50),math.random(-50,50))
            end
        -- Reanimation
        elseif target:GetAttribute("IsDead") then
            for p, corpse in pairs(deadPlayers) do
                if corpse == target.Parent then
                    p:LoadCharacter()
                    corpse:Destroy()
                    deadPlayers[p] = nil
                end
            end
        end
    end
end)

-- Client-side (LocalScript)
if Tool:IsA("Tool") then
    Tool.Activated:Connect(function()
        local mouse = game.Players.LocalPlayer:GetMouse()
        local target = mouse.Target
        if target then
            ReanimateEvent:FireServer(target)
        end
    end)
end
