-- HRP Hitbox Separation - Server-Side Visible
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Configuration
local TARGET_POSITION = Vector3.new(100, 500, 200) -- Set your desired HRP location
local SEPARATION_ACTIVE = false
local RealCharacter, RealHRP

local function SetupSeparation()
    if not LocalPlayer.Character then return false end
    
    RealCharacter = LocalPlayer.Character
    RealHRP = RealCharacter:WaitForChild("HumanoidRootPart")
    
    -- Make character collisionless on server side
    for _, part in ipairs(RealCharacter:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
            part.Massless = true
        end
    end
    
    -- Anchor HRP at target position (server-side)
    RealHRP.Anchored = true
    RealHRP.CFrame = CFrame.new(TARGET_POSITION)
    
    -- Keep camera normal (following character, not HRP)
    local humanoid = RealCharacter:FindFirstChildOfClass("Humanoid")
    if humanoid then
        Camera.CameraSubject = humanoid
    end
    
    return true
end

local function MaintainSeparation()
    if not SEPARATION_ACTIVE then return end
    
    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not SEPARATION_ACTIVE or not RealHRP or not RealHRP.Parent then
            if connection then connection:Disconnect() end
            return
        end
        
        -- Keep HRP anchored at target
        RealHRP.CFrame = CFrame.new(TARGET_POSITION)
        RealHRP.Velocity = Vector3.new(0, 0, 0)
        
        -- Maintain collisionless state
        for _, part in ipairs(RealCharacter:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end)
end

local function StartSeparation()
    if SEPARATION_ACTIVE then return end
    
    if not SetupSeparation() then
        warn("Failed to setup HRP separation")
        return
    end
    
    SEPARATION_ACTIVE = true
    MaintainSeparation()
    
    print("HRP Separation Active")
    print("HRP anchored at: " .. tostring(TARGET_POSITION))
    print("Character is collisionless - Hitbox is separated")
end

local function StopSeparation()
    if not SEPARATION_ACTIVE then return end
    
    SEPARATION_ACTIVE = false
    
    if RealCharacter then
        -- Restore collision
        for _, part in ipairs(RealCharacter:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
                part.Massless = false
            end
        end
        
        -- Unanchor HRP
        RealHRP.Anchored = false
    end
    
    print("HRP Separation Stopped - Normal physics restored")
end

-- Toggle with F key
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F then
        if SEPARATION_ACTIVE then
            StopSeparation()
        else
            StartSeparation()
        end
    end
end)

-- Handle respawns
LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    if SEPARATION_ACTIVE then
        StopSeparation()
        wait(2)
        StartSeparation()
    end
end)

-- Initialize when player joins
if LocalPlayer.Character then
    RealCharacter = LocalPlayer.Character
    RealHRP = RealCharacter:WaitForChild("HumanoidRootPart")
end

print("HRP Hitbox Separation System Loaded")
print("Press F to toggle separation")
print("Your HRP will be anchored at target position")
print("Your character will be collisionless on server side")
