-- Full HRP Separation Script (Reanimation Method)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local TARGET_POSITION = Vector3.new(100, 500, 200)
local REANIMATION_ACTIVE = false
local RealCharacter, FakeCharacter
local RealHRP, FakeHRP, FakeHumanoid

local function CreateFakeCharacter()
    if not LocalPlayer.Character then return false end
    
    RealCharacter = LocalPlayer.Character
    RealHRP = RealCharacter:WaitForChild("HumanoidRootPart")
    local RealHumanoid = RealCharacter:FindFirstChildOfClass("Humanoid")
    
    RealCharacter.Archivable = true
    FakeCharacter = RealCharacter:Clone()
    
    for _, part in ipairs(FakeCharacter:GetDescendants()) do
        if part:IsA("BasePart") then
            part.Transparency = 0
            part.CanCollide = false
            part.Material = Enum.Material.ForceField
        end
    end
    
    for _, obj in ipairs(FakeCharacter:GetDescendants()) do
        if obj:IsA("Decal") then
            obj:Destroy()
        end
    end
    
    local oldHum = FakeCharacter:FindFirstChildOfClass("Humanoid")
    if oldHum then oldHum:Destroy() end
    
    FakeHumanoid = Instance.new("Humanoid")
    FakeHumanoid.Parent = FakeCharacter
    FakeHRP = FakeCharacter:WaitForChild("HumanoidRootPart")
    
    FakeCharacter.Parent = workspace
    FakeCharacter:SetPrimaryPartCFrame(RealHRP.CFrame)
    
    return true
end

local function SetupCamera()
    if not FakeCharacter then return end
    Camera.CameraSubject = FakeHumanoid
end

local function AnchorRealHRP()
    if not RealHRP then return end
    
    RealHRP.Anchored = true
    RealHRP.CFrame = CFrame.new(TARGET_POSITION)
    
    for _, part in ipairs(RealCharacter:GetDescendants()) do
        if part:IsA("BasePart") then
            part.Transparency = 0.9
            part.CanCollide = false
        end
    end
end

local function StartReanimation()
    if REANIMATION_ACTIVE then return end
    
    if not CreateFakeCharacter() then
        warn("Failed to create fake character")
        return
    end
    
    REANIMATION_ACTIVE = true
    AnchorRealHRP()
    SetupCamera()
    
    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not REANIMATION_ACTIVE or not RealHRP or not FakeHRP then
            if connection then connection:Disconnect() end
            return
        end
        
        RealHRP.CFrame = CFrame.new(TARGET_POSITION)
        RealHRP.Velocity = Vector3.new(0, 0, 0)
        
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then
            FakeHRP.CFrame = FakeHRP.CFrame + FakeHRP.CFrame.LookVector * -0.5
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then
            FakeHRP.CFrame = FakeHRP.CFrame + FakeHRP.CFrame.LookVector * 0.5
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then
            FakeHRP.CFrame = FakeHRP.CFrame * CFrame.Angles(0, math.rad(3), 0)
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then
            FakeHRP.CFrame = FakeHRP.CFrame * CFrame.Angles(0, math.rad(-3), 0)
        end
    end)
end

local function StopReanimation()
    if not REANIMATION_ACTIVE then return end
    REANIMATION_ACTIVE = false
    
    if RealCharacter then
        RealHRP.Anchored = false
        for _, part in ipairs(RealCharacter:GetDescendants()) do
            if part:IsA("BasePart") then
                part.Transparency = 0
                part.CanCollide = true
            end
        end
        Camera.CameraSubject = RealCharacter:FindFirstChildOfClass("Humanoid")
    end
    
    if FakeCharacter then
        FakeCharacter:Destroy()
        FakeCharacter = nil
    end
end

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.F then
        if REANIMATION_ACTIVE then
            StopReanimation()
        else
            StartReanimation()
        end
    end
end)

LocalPlayer.CharacterAdded:Connect(function(newCharacter)
    if REANIMATION_ACTIVE then
        StopReanimation()
        wait(2)
        StartReanimation()
    end
end)

if LocalPlayer.Character then
    RealCharacter = LocalPlayer.Character
    RealHRP = RealCharacter:WaitForChild("HumanoidRootPart")
end

print("HRP Separation System Loaded - Press F to toggle")
