-- FE Background Auto-Clicker (Emulator Compatible)
local VirtualInputManager = game:GetService("VirtualInputManager")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Configuration
local TOGGLE_KEY = Enum.KeyCode.Q
local CPS = 20
local CLICK_INTERVAL = 1/CPS

-- State tracking
local enabled = false
local connection = nil

-- Enhanced notification system
local function Notify(message)
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "AUTO-CLICKER",
            Text = message,
            Duration = 3,
            Icon = "rbxassetid://6726578095"
        })
    end)
    print("["..os.date("%X").."] "..message)
end

-- Emulator-compatible click simulation
local function SimulateClick()
    -- Direct mouse event injection
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, nil, nil)
    task.wait(0.001)  -- Minimum press duration
    VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, nil, nil)
end

-- Toggle functionality
local function ToggleAutoClicker()
    enabled = not enabled
    
    if enabled then
        Notify("ENABLED\n20 CPS Background")
        print("Activated - Works when tabbed out")
        
        -- Create background-compatible loop
        if connection then connection:Disconnect() end
        
        connection = RunService.Heartbeat:Connect(function()
            if enabled then
                SimulateClick()
                task.wait(CLICK_INTERVAL)
            end
        end)
    else
        Notify("DISABLED")
        print("Deactivated")
        if connection then
            connection:Disconnect()
            connection = nil
        end
    end
end

-- Key bind setup with emulator focus check
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == TOGGLE_KEY then
        ToggleAutoClicker()
    end
end)

-- Initialization
Notify("Ready - Press Q to toggle")
print("AutoClicker initialized for emulator use")
print("CPS: "..CPS.." | Interval: "..CLICK_INTERVAL.."s")
