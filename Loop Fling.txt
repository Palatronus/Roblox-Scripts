-- FE Ultimate Close-Range Fling System
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

-- GUI Setup
local FlingGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local TargetBox = Instance.new("TextBox")
local ToggleBtn = Instance.new("TextButton")

FlingGui.Name = "FlingControl"
FlingGui.Parent = game.CoreGui

Frame.Parent = FlingGui
Frame.Size = UDim2.new(0, 250, 0, 150)
Frame.Position = UDim2.new(0.5, -125, 0.5, -75)
Frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Frame.BackgroundTransparency = 0
Frame.Active = true
Frame.Draggable = true

TargetBox.Parent = Frame
TargetBox.Size = UDim2.new(0.9, 0, 0.3, 0)
TargetBox.Position = UDim2.new(0.05, 0, 0.1, 0)
TargetBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
TargetBox.TextColor3 = Color3.new(1, 1, 1)
TargetBox.PlaceholderText = "Enter Username"
TargetBox.Font = Enum.Font.Gotham
TargetBox.TextSize = 14

ToggleBtn.Parent = Frame
ToggleBtn.Size = UDim2.new(0.9, 0, 0.3, 0)
ToggleBtn.Position = UDim2.new(0.05, 0, 0.55, 0)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
ToggleBtn.TextColor3 = Color3.new(1, 1, 1)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.Text = "START FLINGING"
ToggleBtn.TextSize = 14

-- Drag System
local dragging, dragInput, dragStart, startPos
Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UIS.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Fling System
local Flinging = false
local Target = nil
local FORCE = 25000
local NOCLIP_CONNECTION = nil

local function GetTarget()
    local targetPlayer = Players:FindFirstChild(TargetBox.Text)
    return targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart")
end

local function EnableNoclip()
    if NOCLIP_CONNECTION then NOCLIP_CONNECTION:Disconnect() end
    NOCLIP_CONNECTION = RunService.Stepped:Connect(function()
        if LP.Character then
            for _, part in pairs(LP.Character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end)
end

local function ViolentFling()
    local BodyVelocity, AlignPos
    
    while Flinging do
        if not LP.Character or not Target or not Target.Parent then
            Target = GetTarget()
            if not Target then break end
            task.wait()
            continue
        end

        local HRP = LP.Character:FindFirstChild("HumanoidRootPart")
        if not HRP then
            task.wait()
            continue
        end

        -- Initialize physics
        if not BodyVelocity then
            BodyVelocity = Instance.new("BodyVelocity")
            BodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            BodyVelocity.P = 200000
            BodyVelocity.Parent = HRP
            
            AlignPos = Instance.new("AlignPosition")
            AlignPos.MaxForce = 900000
            AlignPos.Responsiveness = 200
            AlignPos.Parent = HRP
        end

        -- Direct position locking
        local targetPos = Target.Position
        local offset = Vector3.new(math.random(-2,2), math.random(-1,3), math.random(-2,2))
        
        -- Aggressive teleportation
        HRP.CFrame = CFrame.new(targetPos + offset)
        AlignPos.Position = targetPos + offset
        
        -- Violent velocity forces
        BodyVelocity.Velocity = (Target.Velocity * 1.5) + Vector3.new(
            math.random(-FORCE, FORCE),
            math.random(-FORCE/2, FORCE),
            math.random(-FORCE, FORCE)
        )
        
        -- Extreme rotation
        HRP.RotVelocity = Vector3.new(
            math.random(-FORCE/50, FORCE/50),
            math.random(-FORCE/50, FORCE/50),
            math.random(-FORCE/50, FORCE/50)
        )

        task.wait(0.05)
    end

    -- Cleanup
    if BodyVelocity then BodyVelocity:Destroy() end
    if AlignPos then AlignPos:Destroy() end
end

-- Permanent activation system
local function MaintainFling()
    while task.wait() do
        if Flinging then
            EnableNoclip()
            ViolentFling()
        end
    end
end

-- Toggle System
ToggleBtn.MouseButton1Click:Connect(function()
    Flinging = not Flinging
    ToggleBtn.Text = Flinging and "STOP FLINGING" or "START FLINGING"
    ToggleBtn.BackgroundColor3 = Flinging and Color3.fromRGB(200, 0, 0) or Color3.fromRGB(0, 100, 200)
    
    if Flinging then
        Target = GetTarget()
        coroutine.wrap(MaintainFling)()
    end
end)

-- Death handling
LP.CharacterAdded:Connect(function()
    if Flinging then
        EnableNoclip()
        coroutine.wrap(MaintainFling)()
    end
end)

-- Auto-refresh
RunService.Heartbeat:Connect(function()
    if Flinging and (not Target or not Target.Parent) then
        Target = GetTarget()
    end
end)
