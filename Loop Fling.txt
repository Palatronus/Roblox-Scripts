local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local function align(Part0, Part1)
    -- Keep original alignment function unchanged
    local att1 = Instance.new("Attachment")
    att1.Position = Vector3.new(0, 0, 0)
    local att0 = att1:Clone()

    local ap = Instance.new("AlignPosition", att0)
    ap.ApplyAtCenterOfMass = true
    ap.MaxForce = 9e9
    ap.MaxVelocity = 9e9
    ap.ReactionForceEnabled = false
    ap.Responsiveness = 200
    ap.RigidityEnabled = false
    ap.Attachment1 = att1
    ap.Attachment0 = att0

    att1.Parent = Part1
    att0.Parent = Part0
end

local function createFlingTool()
    if LocalPlayer:FindFirstChild("Backpack") and not LocalPlayer.Backpack:FindFirstChild("Fling") then
        local tool = Instance.new("Tool")
        tool.Name = "Fling"
        tool.RequiresHandle = false
        tool.CanBeDropped = false
        tool.Parent = LocalPlayer.Backpack

        tool.Equipped:Connect(function(mouse)
            mouse.Button1Down:Connect(function()
                local target = mouse.Target
                if not target then return end

                local targetPlayer = Players:GetPlayerFromCharacter(target:FindFirstAncestorWhichIsA("Model"))
                if not targetPlayer or targetPlayer == LocalPlayer then return end

                -- Continuous tracking system
                local trackingActive = true
                local connections = {}
                local anchor = nil

                local function trackCharacter(targetChar)
                    if not targetChar or not targetChar:FindFirstChild("HumanoidRootPart") then return end
                    
                    local character = LocalPlayer.Character
                    if not character then return end
                    local hrp = character:FindFirstChild("HumanoidRootPart")
                    if not hrp then return end

                    -- Original teleport and setup
                    hrp.CFrame = targetChar.HumanoidRootPart.CFrame

                    -- Clean previous attachments
                    if anchor then anchor:Destroy() end
                    for _, conn in pairs(connections) do conn:Disconnect() end

                    -- Original fling setup
                    local parts = {}
                    for _, part in ipairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            if part.CanCollide then
                                table.insert(parts, part)
                            else
                                part.Velocity = Vector3.new(0, -1000, 0)
                            end
                        end
                    end

                    anchor = Instance.new("Part", character)
                    anchor.Name = "FlingAnchor"
                    anchor.Anchored = true
                    anchor.Transparency = 1
                    anchor.CanCollide = false
                    anchor.Size = Vector3.new(2, 2, 1)
                    anchor.CFrame = hrp.CFrame

                    for _, part in ipairs(parts) do
                        align(part, anchor)
                    end

                    -- Persistent tracking
                    connections.follow = RunService.Stepped:Connect(function()
                        if trackingActive and targetChar:FindFirstChild("HumanoidRootPart") then
                            anchor.CFrame = targetChar.HumanoidRootPart.CFrame
                        end
                    end)

                    connections.spin = RunService.Heartbeat:Connect(function()
                        if trackingActive then
                            for _, part in ipairs(parts) do
                                part.Velocity = Vector3.new(0, -25.05, 0)
                                part.RotVelocity = Vector3.new(9999, 9999, 9999)
                            end
                        end
                    end)
                end

                -- Initial tracking
                trackCharacter(targetPlayer.Character)

                -- Death/respawn handler
                connections.respawn = targetPlayer.CharacterAdded:Connect(function(newChar)
                    trackCharacter(newChar)
                end)

                -- Automatic cleanup
                tool.Unequipped:Connect(function()
                    trackingActive = false
                    if anchor then anchor:Destroy() end
                    for _, conn in pairs(connections) do conn:Disconnect() end
                end)
            end)
        end)
    end
end

createFlingTool()

LocalPlayer.CharacterAdded:Connect(function()
    task.wait(1)
    createFlingTool()
end)
