local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")
local LP = Players.LocalPlayer
local ActiveThreads = {}
local Flinging = false
local VoidPower = 10000

-- [PASTE THE PREVIOUS GUI CODE HERE] --

-- Nuclear Fling Core Functions
local function GetTargets()
    local targets = {}
    for username in string.gmatch(Input.Text:lower(), "[^,]+") do
        username = username:gsub("^%s+", ""):gsub("%s+$", "")
        for _, player in next, Players:GetPlayers() do
            if player ~= LP and player.Name:lower() == username then
                table.insert(targets, player)
            end
        end
    end
    return targets
end

local function AtomicFling(target)
    while Flinging and task.wait() do
        if not target.Character then continue end
        local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
        local myChar = LP.Character
        local myHRP = myChar and myChar:FindFirstChild("HumanoidRootPart")
        
        if targetHRP and myHRP then
            -- Network control
            if targetHRP:GetNetworkOwner() ~= LP then
                targetHRP:SetNetworkOwner(LP)
            end
            
            -- Positional pattern
            local orbitPos = targetHRP.Position + Vector3.new(
                math.random(-15, 15),
                math.random(10, 25),
                math.random(-15, 15)
            )
            
            -- Velocity manipulation
            myHRP.CFrame = CFrame.new(orbitPos)
            myHRP.Velocity = (targetHRP.Position - orbitPos).Unit * VoidPower
                            + Vector3.new(0, VoidPower/1.2, 0)
            myHRP.RotVelocity = Vector3.new(
                math.random(-100,100),
                math.random(-100,100),
                math.random(-100,100)
            )
        end
    end
end

-- Toggle Functionality Fix
Toggle.MouseButton1Click:Connect(function()
    Flinging = not Flinging
    Status.Text = Flinging and "Status: Starting..." or "Status: Stopping..."
    
    if Flinging then
        local targets = GetTargets()
        if #targets == 0 then
            Status.Text = "Error: No valid targets!"
            Flinging = false
            return
        end
        
        for _, target in pairs(targets) do
            ActiveThreads[target] = task.spawn(function()
                AtomicFling(target)
            end)
        end
        Status.Text = `Flinging {#targets} targets`
        
    else
        for target, thread in pairs(ActiveThreads) do
            task.cancel(thread)
        end
        ActiveThreads = {}
        Status.Text = "Status: Inactive"
        
        if LP.Character and LP.Character:FindFirstChild("HumanoidRootPart") then
            LP.Character.HumanoidRootPart.Velocity = Vector3.zero
        end
    end
end)

-- Auto-cleanup
Players.PlayerRemoving:Connect(function(player)
    if ActiveThreads[player] then
        task.cancel(ActiveThreads[player])
        ActiveThreads[player] = nil
    end
end)

print("Fling system initialized successfully")
