-- Add to top with other services
local RunService = game:GetService("RunService")

-- Modified FlingTarget function with prediction
local function FlingTarget(target)
    while Flinging and task.wait(0.02) do
        if target and target.Character and LP.Character then
            local tHRP = target.Character:FindFirstChild("HumanoidRootPart")
            local myHRP = LP.Character:FindFirstChild("HumanoidRootPart")
            local humanoid = target.Character:FindFirstChildOfClass("Humanoid")
            
            if tHRP and myHRP and humanoid and humanoid.Health > 0 then
                -- Calculate predicted position with velocity
                local predictionTime = 0.35 -- Seconds to predict ahead
                local predictedPosition = tHRP.Position + (tHRP.Velocity * predictionTime)
                
                -- Enhanced fling formula with prediction
                myHRP.CFrame = CFrame.lookAt(
                    myHRP.Position,
                    predictedPosition
                ) * CFrame.Angles(0, math.rad(math.random(-15,15)), 0)
                
                -- Apply force towards predicted position with rotational boost
                myHRP.Velocity = (predictedPosition - myHRP.Position).Unit * 5200 
                                + (tHRP.Velocity * 0.7)
                                + Vector3.new(0, 2650, 0)
            end
        else
            Flinging = false
            Toggle.Text = "TOGGLE FLING"
            break
        end
    end
end

-- Improved zoom control with momentum
local zoomMomentum = 0
local lastZoomTime = 0

UIS.InputChanged:Connect(function(input)
    if Tracking and input.UserInputType == Enum.UserInputType.MouseWheel then
        -- Smoother zoom with momentum-based interpolation
        local now = tick()
        local delta = input.Position.Z * 1.8
        zoomMomentum = (now - lastZoomTime < 0.1) and zoomMomentum * 0.6 + delta or delta
        CameraDistance = math.clamp(CameraDistance - zoomMomentum, 5, 25)
        lastZoomTime = now
    end
end)

-- Add camera angle variation while tracking
local originalTrackTarget = TrackTarget
TrackTarget = function(target)
    local baseCFrame = CFrame.new()
    RunService.Heartbeat:Connect(function()
        if Tracking and target and target.Character then
            local hrp = target.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                -- Add subtle rotating effect to camera
                baseCFrame = CFrame.new(
                    hrp.Position + Vector3.new(
                        math.sin(tick())*1.5, 
                        5 + math.cos(tick()*0.5)*0.3, 
                        CameraDistance
                    ),
                    hrp.Position
                )
            end
        end
    end)
    return originalTrackTarget(target)
end
