local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local lp = Players.LocalPlayer

-- GUI Setup
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "FlingSystem"

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 250, 0, 150)
mainFrame.Position = UDim2.new(0.5, -125, 0.5, -75)
mainFrame.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = gui

local dragHandle = Instance.new("TextLabel")
dragHandle.Size = UDim2.new(1, 0, 0, 25)
dragHandle.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
dragHandle.Text = "Fling Controller"
dragHandle.TextColor3 = Color3.new(1, 1, 1)
dragHandle.Parent = mainFrame

local inputBox = Instance.new("TextBox")
inputBox.Size = UDim2.new(0.9, 0, 0, 30)
inputBox.Position = UDim2.new(0.05, 0, 0.25, 0)
inputBox.PlaceholderText = "Enter username"
inputBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
inputBox.TextColor3 = Color3.new(1, 1, 1)
inputBox.Parent = mainFrame

local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0.9, 0, 0, 35)
toggleBtn.Position = UDim2.new(0.05, 0, 0.6, 0)
toggleBtn.Text = "START FLING"
toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Parent = mainFrame

-- Fling System
local flingActive = false
local targetPlayer = nil
local connection = nil

local function getPlayer(name)
    name = name:lower()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= lp and (player.Name:lower():find(name) or player.DisplayName:lower():find(name)) then
            return player
        end
    end
    return nil
end

local function prepareCharacter()
    if not lp.Character then return end
    for _, v in pairs(lp.Character:GetDescendants()) do
        if v:IsA("BasePart") then
            v.CanCollide = false
            v.Massless = true
        end
    end
end

local function aggressiveFling()
    if not targetPlayer or not targetPlayer.Character or not targetPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
    if not lp.Character or not lp.Character:FindFirstChild("HumanoidRootPart") then return end
    
    local root = lp.Character.HumanoidRootPart
    local tRoot = targetPlayer.Character.HumanoidRootPart
    
    local predictedPosition = tRoot.Position + (tRoot.Velocity * 0.25)
    local direction = (predictedPosition - root.Position).Unit
    
    root.Velocity = direction * 100 + Vector3.new(
        math.random(-25, 25),
        math.random(15, 35),
        math.random(-25, 25)
    )
end

-- Control System
toggleBtn.MouseButton1Click:Connect(function()
    flingActive = not flingActive
    toggleBtn.Text = flingActive and "STOP FLING" or "START FLING"
    
    if flingActive then
        targetPlayer = getPlayer(inputBox.Text)
        if not targetPlayer then
            inputBox.Text = "Invalid player!"
            task.wait(1)
            inputBox.Text = ""
            flingActive = false
            toggleBtn.Text = "START FLING"
            return
        end
        
        prepareCharacter()
        connection = RunService.Heartbeat:Connect(function()
            pcall(aggressiveFling)
        end)
    else
        if connection then
            connection:Disconnect()
            connection = nil
        end
        if lp.Character and lp.Character:FindFirstChild("HumanoidRootPart") then
            lp.Character.HumanoidRootPart.Velocity = Vector3.new()
        end
    end
end)

-- Auto-cleanup
Players.PlayerRemoving:Connect(function(player)
    if player == targetPlayer then
        flingActive = false
        toggleBtn.Text = "START FLING"
        if connection then
            connection:Disconnect()
            connection = nil
        end
    end
end)

-- Final safety check
if connection then
    connection:Disconnect()
end
