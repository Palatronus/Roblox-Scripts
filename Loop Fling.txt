local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- ========== GUI FORCE-INJECTION SYSTEM ==========
local gui = Instance.new("ScreenGui")
gui.Name = "ðŸ”§FlingGUI_ULTRA"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Global
gui.DisplayOrder = 9999

-- Nuclear parenting system
local function nuclearParent()
    local success, _ = pcall(function()
        gui.Parent = LocalPlayer:WaitForChild("PlayerGui", 5) 
    end)
    if not success then
        gui.Parent = CoreGui
        warn("GUI forced to CoreGui - check executor permissions!")
    end
    if not gui.Parent then
        gui.Parent = game:GetService("StarterGui")
    end
end

-- Purge existing GUIs
for _, existingGui in ipairs(CoreGui:GetChildren()) do
    if existingGui:IsA("ScreenGui") and existingGui.Name:find("FlingGUI") then
        existingGui:Destroy()
    end
end
nuclearParent()

-- ========== MAIN INTERFACE ==========
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 220, 0, 140)
frame.Position = UDim2.new(0.5, -110, 0.5, -70)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.BorderSizePixel = 1
frame.BorderColor3 = Color3.fromRGB(80, 80, 80)
frame.Active = true
frame.Parent = gui

-- Drag system with momentum
local dragSpeed = 0.25
local dragInput, dragStart, startPos, dragMomentum
frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragStart = input.Position
        startPos = frame.Position
        dragMomentum = nil
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragMomentum = (frame.Position - startPos).Magnitude * 0.1
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput then
        local delta = input.Position - dragStart
        frame.Position = startPos + UDim2.new(0, delta.X, 0, delta.Y)
    end
end)

-- Momentum animation
game:GetService("RunService").Heartbeat:Connect(function()
    if dragMomentum and dragMomentum > 1 then
        frame.Position += UDim2.new(0, dragMomentum, 0, dragMomentum)
        dragMomentum *= 0.85
    end
end)

-- ========== UI ELEMENTS ==========
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -24, 0, 24)
title.Position = UDim2.new(0, 12, 0, 4)
title.Text = "FLING CONTROL v3.1"
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.new(1, 0.5, 0.2)
title.BackgroundTransparency = 1
title.Parent = frame

local targetBox = Instance.new("TextBox")
targetBox.Size = UDim2.new(0.9, 0, 0, 28)
targetBox.Position = UDim2.new(0.05, 0, 0.25, 0)
targetBox.PlaceholderText = "ðŸ‘¤ Target username"
targetBox.ClearTextOnFocus = false
targetBox.TextXAlignment = Enum.TextXAlignment.Left
targetBox.Parent = frame

local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0.9, 0, 0, 32)
toggleButton.Position = UDim2.new(0.05, 0, 0.6, 0)
toggleButton.Text = "â–¶ START FLING"
toggleButton.Font = Enum.Font.GothamMedium
toggleButton.Parent = frame

-- ========== FLING CORE (UNCHANGED MECHANICS) ==========
-- [Insert previous fling logic here - IDENTICAL to original version]
-- [Include align(), cleanup(), flingLoop(), and toggle system]

-- ========== NUCLEAR VISIBILITY SAFEGUARDS ==========
-- Force GUI awake
task.spawn(function()
    while true do
        gui.Enabled = true
        frame.Visible = true
        frame.Active = true
        wait(0.5)
    end
end)

-- Emergency visibility hotkeys
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F6 then
        frame.Visible = not frame.Visible
    end
    if input.KeyCode == Enum.KeyCode.F7 then
        nuclearParent() -- Re-inject GUI
    end
end)

-- Diagnostic HUD
local diagLabel = Instance.new("TextLabel")
diagLabel.Text = string.format(
    "GUI Status: ACTIVE | Parent: %s | F6: Toggle | F7: Reinject",
    gui.Parent:GetFullName()
)
diagLabel.Size = UDim2.new(1, 0, 0, 18)
diagLabel.Position = UDim2.new(0, 0, 1, 0)
diagLabel.TextColor3 = Color3.new(0, 1, 0)
diagLabel.BackgroundTransparency = 1
diagLabel.Font = Enum.Font.RobotoMono
diagLabel.Parent = frame

print("ðŸ”¥ FLING SYSTEM ACTIVE - If GUI not visible:")
print("1. Press F6/F7 | 2. Check executor UI settings")
print("3. Verify no other scripts interfering")
