-- FE Ultimate Fling Tool v2 (GUI + Prediction + Loop)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

-- GUI Setup
local FlingGui = Instance.new("ScreenGui")
local Frame = Instance.new("Frame")
local TargetBox = Instance.new("TextBox")
local ToggleBtn = Instance.new("TextButton")

FlingGui.Name = "FlingControl"
FlingGui.Parent = game.CoreGui
FlingGui.ResetOnSpawn = false

-- Draggable GUI Implementation
Frame.Parent = FlingGui
Frame.Size = UDim2.new(0, 220, 0, 120)
Frame.Position = UDim2.new(0.5, -110, 0.5, -60)
Frame.BackgroundTransparency = 0.5
Frame.Active = true

-- [Insert Previous Drag Code Here]

-- Fling Parameters
local Flinging = false
local Target = nil
local PREDICTION_FACTOR = 1.25
local FLING_FORCE = 9500
local SPIN_VELOCITY = Vector3.new(9000, 9000, 9000)

local function GetTarget()
    local targetPlayer = Players:FindFirstChild(TargetBox.Text)
    return targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart")
end

local function ViolentFling()
    local character = LP.Character
    if not character then return end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- Collision disable
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end

    -- Fling loop
    while Flinging and task.wait() do
        if not Target or not Target.Parent then
            Target = GetTarget()
            if not Target then break end
        end

        -- Prediction calculation
        local targetVel = Target.Velocity
        local predictedPos = Target.Position + (targetVel * PREDICTION_FACTOR)
        
        -- CFrame manipulation
        hrp.CFrame = CFrame.lookAt(predictedPos, Target.Position) 
                     * CFrame.Angles(math.rad(90), 0, 0)
        
        -- Velocity forces
        hrp.Velocity = (predictedPos - hrp.Position).Unit * FLING_FORCE
        hrp.RotVelocity = SPIN_VELOCITY
        
        -- Secondary parts control
        for _, part in ipairs(character:GetDescendants()) do
            if part:IsA("BasePart") and part ~= hrp then
                part.Velocity = Vector3.new(0, -100, 0)
                part.RotVelocity = SPIN_VELOCITY
            end
        end
    end

    -- Cleanup
    hrp.RotVelocity = Vector3.new()
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = true
        end
    end
end

-- Toggle Handler
ToggleBtn.MouseButton1Click:Connect(function()
    Flinging = not Flinging
    if Flinging then
        Target = GetTarget()
        if Target then
            coroutine.wrap(ViolentFling)()
        end
    end
end)

-- Tool Integration
local function createFlingTool()
    if not LP:FindFirstChild("Backpack") then return end
    
    local tool = Instance.new("Tool")
    tool.Name = "FlingController"
    tool.RequiresHandle = false
    tool.Parent = LP.Backpack

    tool.Equipped:Connect(function()
        FlingGui.Enabled = true
    end)

    tool.Unequipped:Connect(function()
        FlingGui.Enabled = false
    end)
end

-- Initialization
createFlingTool()
LP.CharacterAdded:Connect(createFlingTool)
